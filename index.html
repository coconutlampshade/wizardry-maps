<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wizardry Map Maker</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Wizardry Map Maker</h1>
    <div class="floor-tabs" id="floor-tabs">
      <button class="floor-tab active" data-floor="1">1</button>
      <button class="floor-tab" data-floor="2">2</button>
      <button class="floor-tab" data-floor="3">3</button>
      <button class="floor-tab" data-floor="4">4</button>
      <button class="floor-tab" data-floor="5">5</button>
      <button class="floor-tab" data-floor="6">6</button>
      <button class="floor-tab" data-floor="7">7</button>
      <button class="floor-tab" data-floor="8">8</button>
      <button class="floor-tab" data-floor="9">9</button>
      <button class="floor-tab" data-floor="10">10</button>
    </div>
    <div class="header-buttons">
      <span id="save-indicator" class="save-indicator">Saved</span>
      <button id="save-btn" class="btn-primary" title="Download backup">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
          <polyline points="17 21 17 13 7 13 7 21"/>
          <polyline points="7 3 7 8 15 8"/>
        </svg>
        Save
      </button>
      <div class="btn-group">
        <button id="import-btn" title="Import JSON">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>
        <button id="export-btn" title="Export JSON">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
        </button>
      </div>
      <button id="theme-btn" title="Toggle light/dark mode">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
      </button>
      <button id="guide-btn" title="User guide">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
      </button>
    </div>
  </header>

  <main>
    <aside class="toolbar">
      <div class="tool-section">
        <h3>Walls & Doors</h3>
        <div class="tool-group">
          <button class="tool-btn" data-tool="wall">
            <span class="swatch swatch-wall"></span> Wall
          </button>
          <button class="tool-btn" data-tool="door" data-door-type="normal">
            <span class="swatch swatch-door"></span> Door
          </button>
          <button class="tool-btn" data-tool="door" data-door-type="locked">
            <span class="swatch swatch-door-locked"></span> Locked
          </button>
          <button class="tool-btn" data-tool="door" data-door-type="secret">
            <span class="swatch swatch-door-secret"></span> Secret
          </button>
          <button class="tool-btn" data-tool="door" data-door-type="one-way">
            <span class="swatch swatch-door-oneway"></span> One-Way
          </button>
          <button class="tool-btn" data-tool="door" data-door-type="secret-one-way">
            <span class="swatch swatch-door-secret-oneway"></span> Secret 1-Way
          </button>
        </div>
      </div>

      <div class="tool-section">
        <h3>Navigation</h3>
        <div class="tool-group">
          <button class="tool-btn" data-tool="content" data-content="stairs-up">
            <span class="swatch swatch-icon" style="background: var(--stairs-up)">U</span> Stairs Up
          </button>
          <button class="tool-btn" data-tool="content" data-content="stairs-down">
            <span class="swatch swatch-icon" style="background: var(--stairs-down)">D</span> Stairs Down
          </button>
          <button class="tool-btn" data-tool="content" data-content="elevator">
            <span class="swatch swatch-icon" style="background: var(--elevator); color: #000;">E</span> Elevator
          </button>
          <button class="tool-btn" data-tool="teleporter">
            <span class="swatch swatch-icon" style="background: var(--teleporter)">T</span> Teleporter
          </button>
        </div>
      </div>

      <div class="tool-section">
        <h3>Hazards</h3>
        <div class="tool-group">
          <button class="tool-btn" data-tool="content" data-content="pit">
            <span class="swatch swatch-icon" style="background: var(--pit)">O</span> Pit
          </button>
          <button class="tool-btn" data-tool="content" data-content="chute">
            <span class="swatch swatch-icon" style="background: var(--chute)">V</span> Chute
          </button>
          <button class="tool-btn" data-tool="content" data-content="spinner">
            <span class="swatch swatch-icon" style="background: var(--spinner)">@</span> Spinner
          </button>
          <button class="tool-btn" data-tool="content" data-content="darkness">
            <span class="swatch swatch-icon" style="background: var(--darkness)">?</span> Darkness
          </button>
          <button class="tool-btn" data-tool="content" data-content="antimagic">
            <span class="swatch swatch-icon" style="background: var(--antimagic)">X</span> Anti-Magic
          </button>
        </div>
      </div>

      <div class="tool-section">
        <h3>Markers</h3>
        <div class="tool-group">
          <button class="tool-btn" data-tool="note">
            <span class="swatch swatch-note"></span> Note
          </button>
          <button class="tool-btn" data-tool="content" data-content="inaccessible">
            <span class="swatch" style="background: #444"></span> Inaccessible
          </button>
        </div>
      </div>
    </aside>

    <section class="map-container">
      <div class="map-header">
        <div id="map-info" class="map-info">Floor 1 | Player: (0, 0) facing N</div>
        <div id="compass" class="compass">
          <span class="compass-label">Up=</span>
          <span id="compass-direction" class="compass-direction">N</span>
        </div>
      </div>
      <div class="map-with-coords">
        <div class="coord-row">
          <div class="coord-corner"></div>
          <div class="coord-labels-x">
            <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span>
            <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span>
            <span>10</span><span>11</span><span>12</span><span>13</span><span>14</span>
            <span>15</span><span>16</span><span>17</span><span>18</span><span>19</span>
          </div>
          <div class="coord-corner"></div>
        </div>
        <div class="map-row">
          <div class="coord-labels-y">
            <span>19</span><span>18</span><span>17</span><span>16</span><span>15</span>
            <span>14</span><span>13</span><span>12</span><span>11</span><span>10</span>
            <span>9</span><span>8</span><span>7</span><span>6</span><span>5</span>
            <span>4</span><span>3</span><span>2</span><span>1</span><span>0</span>
          </div>
          <div id="map-grid" class="map-grid"></div>
          <div class="coord-labels-y">
            <span>19</span><span>18</span><span>17</span><span>16</span><span>15</span>
            <span>14</span><span>13</span><span>12</span><span>11</span><span>10</span>
            <span>9</span><span>8</span><span>7</span><span>6</span><span>5</span>
            <span>4</span><span>3</span><span>2</span><span>1</span><span>0</span>
          </div>
        </div>
        <div class="coord-row">
          <div class="coord-corner"></div>
          <div class="coord-labels-x">
            <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span>
            <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span>
            <span>10</span><span>11</span><span>12</span><span>13</span><span>14</span>
            <span>15</span><span>16</span><span>17</span><span>18</span><span>19</span>
          </div>
          <div class="coord-corner"></div>
        </div>
      </div>
      <div class="shortcuts-bar">
        <span><kbd>Arrow/WASD</kbd> Move</span>
        <span><kbd>Shift+WASD</kbd> Walls</span>
        <span><kbd>Shift+Click</kbd> Delete</span>
        <span><kbd>1-0</kbd> Floors</span>
        <span><kbd>R</kbd> Rotate</span>
        <span><kbd>Shift+R</kbd> Rotate map</span>
        <span><kbd>G</kbd> Explored</span>
        <span><kbd>Shift+G</kbd> Fill room</span>
        <span><kbd>Z</kbd> Undo</span>
        <span><kbd>Shift+Z</kbd> Redo</span>
        <span><kbd>Cmd+Opt+Click</kbd> Path</span>
      </div>
    </section>
  </main>

  <!-- Import Modal -->
  <div id="import-modal" class="modal-overlay">
    <div class="modal">
      <h2>Import Map Data</h2>
      <textarea id="import-data" placeholder="Paste JSON map data here..."></textarea>
      <div class="modal-buttons">
        <button id="import-cancel" class="secondary">Cancel</button>
        <button id="import-confirm" class="primary">Import</button>
      </div>
    </div>
  </div>

  <!-- Note Modal -->
  <div id="note-modal" class="modal-overlay">
    <div class="modal">
      <h2>Cell Note</h2>
      <input type="text" id="note-input" class="note-input" placeholder="Enter note for this cell...">
      <div class="modal-buttons">
        <button id="note-cancel" class="secondary">Cancel</button>
        <button id="note-save" class="primary">Save</button>
      </div>
    </div>
  </div>

  <!-- Teleporter Modal -->
  <div id="teleporter-modal" class="modal-overlay">
    <div class="modal">
      <h2>Teleporter</h2>
      <p class="modal-hint">Enter number for source (e.g., "1") or number with apostrophe for destination (e.g., "1'")</p>
      <input type="text" id="teleporter-input" class="note-input" placeholder="e.g., 1 or 1'">
      <div class="modal-buttons">
        <button id="teleporter-cancel" class="secondary">Cancel</button>
        <button id="teleporter-save" class="primary">Save</button>
      </div>
    </div>
  </div>

  <!-- User Guide Panel -->
  <div id="guide-overlay" class="guide-overlay"></div>
  <aside id="user-guide" class="guide-panel">
    <div class="guide-header">
      <h2>User Guide</h2>
      <button id="guide-close" class="guide-close" aria-label="Close guide">&times;</button>
    </div>
    <div class="guide-body">
      <section class="guide-section">
        <h3>Getting Started</h3>
        <p>Create dungeon maps for Wizardry: Proving Grounds of the Mad Overlord. Each floor is a 20x20 grid. The green arrow shows your position and facing.</p>
      </section>

      <section class="guide-section">
        <h3>Navigation</h3>
        <dl>
          <dt>Click cell</dt><dd>Move player there</dd>
          <dt>Arrow / WASD</dt><dd>Move player</dd>
          <dt>R</dt><dd>Rotate facing</dd>
          <dt>Shift+R</dt><dd>Rotate map view</dd>
          <dt>1-9, 0</dt><dd>Switch floors</dd>
        </dl>
      </section>

      <section class="guide-section">
        <h3>Walls & Doors</h3>
        <dl>
          <dt>Click edge</dt><dd>Add wall or door</dd>
          <dt>Shift+WASD</dt><dd>Toggle wall</dd>
          <dt>Shift+Click</dt><dd>Delete wall/door</dd>
          <dt>Click door</dt><dd>Cycle door types</dd>
        </dl>
      </section>

      <section class="guide-section">
        <h3>Cell Features</h3>
        <dl>
          <dt>Select + Click</dt><dd>Place feature</dd>
          <dt>Shift+Click</dt><dd>Clear cell</dd>
          <dt>G</dt><dd>Mark explored</dd>
          <dt>Shift+G</dt><dd>Flood-fill explored</dd>
        </dl>
      </section>

      <section class="guide-section">
        <h3>Pathfinding</h3>
        <dl>
          <dt>Cmd+Opt+Click</dt><dd>Set start</dd>
          <dt>Cmd+Opt+Click</dt><dd>Set end / clear</dd>
        </dl>
        <p class="guide-note">Directions: F=Forward, L=Left, R=Right, O=Open</p>
      </section>

      <section class="guide-section">
        <h3>Other</h3>
        <dl>
          <dt>Z / Shift+Z</dt><dd>Undo / Redo</dd>
          <dt>Save</dt><dd>Download backup</dd>
          <dt>Import/Export</dt><dd>JSON data</dd>
        </dl>
      </section>

      <section class="guide-section">
        <h3>Legend</h3>
        <div class="legend-items">
          <span class="legend-item"><em>U</em> Stairs Up</span>
          <span class="legend-item"><em>D</em> Stairs Down</span>
          <span class="legend-item"><em>O</em> Pit</span>
          <span class="legend-item"><em>V</em> Chute</span>
          <span class="legend-item"><em>@</em> Spinner</span>
          <span class="legend-item"><em>E</em> Elevator</span>
          <span class="legend-item"><em>?</em> Darkness</span>
          <span class="legend-item"><em>X</em> Anti-Magic</span>
          <span class="legend-item"><em>1</em> Teleporter source</span>
          <span class="legend-item"><em>1'</em> Teleporter dest</span>
        </div>
      </section>
    </div>
  </aside>

  <script src="map-data.js"></script>
  <script src="app.js"></script>
</body>
</html>
